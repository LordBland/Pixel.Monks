const API_URL="https://project-p-server-hg62gkdjeq-rj.a.run.app/hit",SESSION_ID_KEY="MMPsessionId",HASH_KEY="MMhash",DEVICE_ID_KEY="MMdevice",LETTERS="abcdefghijklmnopqrstuvwxyz";function generateUniqueId(){let e=LETTERS.charAt(Math.floor(Math.random()*LETTERS.length)),t=Date.now().toString(36),n=Math.random().toString(36).substr(2,5);return e+"-"+t+n}function getOperatingSystem(){let e=navigator.userAgent,t=e.match(/(Windows|Mac|Linux|Android|iOS)/i);return t?t[0]:"desconhecido"}function sendToApi(e){fetch("https://project-p-server-hg62gkdjeq-rj.a.run.app/hit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>console.log(e)).catch(e=>console.error(e))}function generateSessionId(){let e="SE-"+generateUniqueId();return sessionStorage.setItem(SESSION_ID_KEY,e),e}function generatePointer(){let e=generateUniqueId(),t="P-"+e+"-"+Date.now();return sessionStorage.setItem(HASH_KEY,e),t}function generateDeviceId(){let e="DE/"+generateUniqueId()+Date.now().toString(36)+"/"+getOperatingSystem();return localStorage.setItem(DEVICE_ID_KEY,e),e}function getSessionId(){return sessionStorage.getItem(SESSION_ID_KEY)}function getPointer(){let e=sessionStorage.getItem(HASH_KEY);return"P-"+e+"-"+Date.now()}function getDeviceId(){return localStorage.getItem(DEVICE_ID_KEY)}function buildEventData(e,t){return{type:e,timestamp:Date.now(),session_id:getSessionId(),system:getOperatingSystem(),url:document.URL,ref:document.referrer,pointer:getPointer(),client_id:t.client,...t}}function processEvent(e){let{type:t}=e,n;switch(t){case"purchase":case"checkout":case"view_product":case"add_product":case"remove_product":case"view_product_list":case"add_product_list":case"form":case"gen":sendToApi(n=buildEventData(t,e));break;case"page_view":let r=getSessionId();r||(generateSessionId(),generatePointer()),sendToApi(n=buildEventData("session_start",e)),sendToApi(n=buildEventData("page_view",e));break;default:console.error(`Event type ${t} is not supported.`)}}function pm(e){processEvent(e)}
